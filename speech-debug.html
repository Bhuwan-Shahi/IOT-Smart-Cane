<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speech Debug - Smart Cane</title>
    <style>
        body {
            font-family: monospace;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #00ff00;
        }
        .debug-container {
            background: #000;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #00ff00;
        }
        button {
            padding: 10px 15px;
            margin: 5px;
            background: #00ff00;
            color: #000;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-family: monospace;
        }
        button:hover {
            background: #00cc00;
        }
        #debugOutput {
            background: #000;
            border: 1px solid #333;
            padding: 10px;
            height: 300px;
            overflow-y: auto;
            margin-top: 10px;
            font-size: 12px;
        }
        .info { color: #00ffff; }
        .warning { color: #ffff00; }
        .error { color: #ff0000; }
        .success { color: #00ff00; }
    </style>
</head>
<body>
    <div class="debug-container">
        <h1>🔊 Speech Synthesis Debug Console</h1>
        
        <h3>Browser Information:</h3>
        <div id="browserInfo"></div>
        
        <h3>Speech Synthesis Status:</h3>
        <div id="speechStatus"></div>
        
        <h3>Available Voices:</h3>
        <div id="voicesList"></div>
        
        <h3>Test Controls:</h3>
        <button onclick="checkBrowserSupport()">Check Browser Support</button>
        <button onclick="listVoices()">List Available Voices</button>
        <button onclick="testBasicSpeech()">Test Basic Speech</button>
        <button onclick="testWithDifferentVoice()">Test Different Voice</button>
        <button onclick="testVolumeSettings()">Test Volume Settings</button>
        <button onclick="clearLog()">Clear Log</button>
        
        <div id="debugOutput"></div>
    </div>

    <script>
        let debugOutput = document.getElementById('debugOutput');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type;
            debugOutput.innerHTML += `<div class="${colorClass}">[${timestamp}] ${message}</div>`;
            debugOutput.scrollTop = debugOutput.scrollHeight;
            console.log(message);
        }
        
        function clearLog() {
            debugOutput.innerHTML = '';
        }
        
        function checkBrowserSupport() {
            log('=== BROWSER SUPPORT CHECK ===', 'info');
            
            // Check if speechSynthesis is available
            if ('speechSynthesis' in window) {
                log('✅ Speech Synthesis API is supported', 'success');
                
                // Check if voices are available
                const voices = speechSynthesis.getVoices();
                log(`📢 Found ${voices.length} voices initially`, 'info');
                
                if (voices.length === 0) {
                    log('⏳ Voices not loaded yet, waiting for voiceschanged event...', 'warning');
                    speechSynthesis.addEventListener('voiceschanged', () => {
                        const newVoices = speechSynthesis.getVoices();
                        log(`📢 Voices loaded: ${newVoices.length} available`, 'success');
                        listVoices();
                    });
                } else {
                    log('✅ Voices already available', 'success');
                }
                
                // Check if speaking
                log(`🔊 Currently speaking: ${speechSynthesis.speaking}`, 'info');
                log(`⏸️ Currently paused: ${speechSynthesis.paused}`, 'info');
                log(`⏳ Currently pending: ${speechSynthesis.pending}`, 'info');
                
            } else {
                log('❌ Speech Synthesis API is NOT supported in this browser', 'error');
            }
            
            // Browser info
            log(`🌐 User Agent: ${navigator.userAgent}`, 'info');
            log(`📱 Platform: ${navigator.platform}`, 'info');
        }
        
        function listVoices() {
            log('=== AVAILABLE VOICES ===', 'info');
            const voices = speechSynthesis.getVoices();
            
            if (voices.length === 0) {
                log('❌ No voices available', 'error');
                return;
            }
            
            voices.forEach((voice, index) => {
                const isDefault = voice.default ? ' [DEFAULT]' : '';
                const isLocal = voice.localService ? ' [LOCAL]' : ' [REMOTE]';
                log(`${index + 1}. ${voice.name} (${voice.lang})${isDefault}${isLocal}`, 'info');
            });
            
            // Find English voices
            const englishVoices = voices.filter(voice => voice.lang.startsWith('en'));
            log(`🇺🇸 Found ${englishVoices.length} English voices`, 'success');
        }
        
        function testBasicSpeech() {
            log('=== TESTING BASIC SPEECH ===', 'info');
            
            if (!('speechSynthesis' in window)) {
                log('❌ Speech synthesis not supported', 'error');
                return;
            }
            
            // Cancel any ongoing speech
            speechSynthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance('Hello, this is a speech test for Smart Cane navigation.');
            
            utterance.onstart = () => {
                log('▶️ Speech started successfully', 'success');
            };
            
            utterance.onend = () => {
                log('✅ Speech completed successfully', 'success');
            };
            
            utterance.onerror = (event) => {
                log(`❌ Speech error: ${event.error} - ${event.message || 'No details'}`, 'error');
            };
            
            utterance.onpause = () => {
                log('⏸️ Speech paused', 'warning');
            };
            
            utterance.onresume = () => {
                log('▶️ Speech resumed', 'info');
            };
            
            log('🚀 Starting speech synthesis...', 'info');
            speechSynthesis.speak(utterance);
        }
        
        function testWithDifferentVoice() {
            log('=== TESTING WITH DIFFERENT VOICE ===', 'info');
            
            const voices = speechSynthesis.getVoices();
            if (voices.length === 0) {
                log('❌ No voices available for testing', 'error');
                return;
            }
            
            // Try to find an English voice
            const englishVoice = voices.find(voice => 
                voice.lang.startsWith('en') && voice.localService
            ) || voices.find(voice => 
                voice.lang.startsWith('en')
            ) || voices[0];
            
            log(`🎤 Using voice: ${englishVoice.name} (${englishVoice.lang})`, 'info');
            
            const utterance = new SpeechSynthesisUtterance('Testing with selected voice. Can you hear this clearly?');
            utterance.voice = englishVoice;
            utterance.volume = 1.0;
            utterance.rate = 0.8;
            utterance.pitch = 1.0;
            
            utterance.onstart = () => {
                log(`▶️ Speaking with ${englishVoice.name}`, 'success');
            };
            
            utterance.onend = () => {
                log('✅ Voice test completed', 'success');
            };
            
            utterance.onerror = (event) => {
                log(`❌ Voice test error: ${event.error}`, 'error');
            };
            
            speechSynthesis.speak(utterance);
        }
        
        function testVolumeSettings() {
            log('=== TESTING VOLUME SETTINGS ===', 'info');
            
            const volumes = [0.2, 0.5, 0.8, 1.0];
            let currentIndex = 0;
            
            function testNextVolume() {
                if (currentIndex >= volumes.length) {
                    log('✅ Volume test completed', 'success');
                    return;
                }
                
                const volume = volumes[currentIndex];
                log(`🔊 Testing volume: ${volume}`, 'info');
                
                const utterance = new SpeechSynthesisUtterance(`Volume test at ${Math.round(volume * 100)} percent`);
                utterance.volume = volume;
                utterance.rate = 0.9;
                
                utterance.onend = () => {
                    currentIndex++;
                    setTimeout(testNextVolume, 500);
                };
                
                utterance.onerror = (event) => {
                    log(`❌ Volume test error at ${volume}: ${event.error}`, 'error');
                    currentIndex++;
                    setTimeout(testNextVolume, 500);
                };
                
                speechSynthesis.speak(utterance);
            }
            
            testNextVolume();
        }
        
        // Initialize on page load
        window.addEventListener('load', () => {
            log('🚀 Speech Debug Console loaded', 'success');
            
            // Display browser info
            document.getElementById('browserInfo').innerHTML = `
                Browser: ${navigator.userAgent}<br>
                Platform: ${navigator.platform}
            `;
            
            // Check initial support
            setTimeout(() => {
                checkBrowserSupport();
                listVoices();
            }, 500);
        });
        
        // Handle voices changed
        if ('speechSynthesis' in window) {
            speechSynthesis.addEventListener('voiceschanged', () => {
                log('🔄 Voices changed event fired', 'info');
                listVoices();
            });
        }
    </script>
</body>
</html>
